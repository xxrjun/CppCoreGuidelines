
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../cp-concurrency-and-parallelism/">
      
      
        <link rel="next" href="../con-constants-and-immutability/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>E: Error handling - C++ Core Guidelines</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#e-error-handling-s-errors" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="C++ Core Guidelines" class="md-header__button md-logo" aria-label="C++ Core Guidelines" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            C++ Core Guidelines
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              E: Error handling
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/xxrjun/CppCoreGuidelines" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    xxrjun/CppCoreGuidelines
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="C++ Core Guidelines" class="md-nav__button md-logo" aria-label="C++ Core Guidelines" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    C++ Core Guidelines
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/xxrjun/CppCoreGuidelines" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    xxrjun/CppCoreGuidelines
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../NOTICE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NOTICE
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../abstract/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Abstract
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../in-introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    In: Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../p-philosophy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P: Philosophy
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../i-interfaces/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    I: Interfaces
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../f-functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    F: Functions
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../c-classes-and-class-hierarchies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    C: Classes and class hierarchies
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../enum-enumerations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Enum: Enumerations
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../r-resource-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    R: Resource management
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../es-expressions-and-statements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ES: Expressions and statements
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../per-performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Per: Performance
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cp-concurrency-and-parallelism/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CP: Concurrency and parallelism
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    E: Error handling
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    E: Error handling
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#e1-develop-an-error-handling-strategy-early-in-a-design" class="md-nav__link">
    <span class="md-ellipsis">
      E.1: Develop an error-handling strategy early in a design
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e2-throw-an-exception-to-signal-that-a-function-cant-perform-its-assigned-task" class="md-nav__link">
    <span class="md-ellipsis">
      E.2: Throw an exception to signal that a function can't perform its assigned task
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e3-use-exceptions-for-error-handling-only" class="md-nav__link">
    <span class="md-ellipsis">
      E.3: Use exceptions for error handling only
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e4-design-your-error-handling-strategy-around-invariants" class="md-nav__link">
    <span class="md-ellipsis">
      E.4: Design your error-handling strategy around invariants
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e5-let-a-constructor-establish-an-invariant-and-throw-if-it-cannot" class="md-nav__link">
    <span class="md-ellipsis">
      E.5: Let a constructor establish an invariant, and throw if it cannot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e6-use-raii-to-prevent-leaks" class="md-nav__link">
    <span class="md-ellipsis">
      E.6: Use RAII to prevent leaks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e7-state-your-preconditions" class="md-nav__link">
    <span class="md-ellipsis">
      E.7: State your preconditions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e8-state-your-postconditions" class="md-nav__link">
    <span class="md-ellipsis">
      E.8: State your postconditions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e12-use-noexcept-when-exiting-a-function-because-of-a-throw-is-impossible-or-unacceptable" class="md-nav__link">
    <span class="md-ellipsis">
      E.12: Use noexcept when exiting a function because of a throw is impossible or unacceptable
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e13-never-throw-while-being-the-direct-owner-of-an-object" class="md-nav__link">
    <span class="md-ellipsis">
      E.13: Never throw while being the direct owner of an object
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e14-use-purpose-designed-user-defined-types-as-exceptions-not-built-in-types" class="md-nav__link">
    <span class="md-ellipsis">
      E.14: Use purpose-designed user-defined types as exceptions (not built-in types)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e15-throw-by-value-catch-exceptions-from-a-hierarchy-by-reference" class="md-nav__link">
    <span class="md-ellipsis">
      E.15: Throw by value, catch exceptions from a hierarchy by reference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e16-destructors-deallocation-swap-and-exception-type-copymove-construction-must-never-fail" class="md-nav__link">
    <span class="md-ellipsis">
      E.16: Destructors, deallocation, swap, and exception type copy/move construction must never fail
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e17-dont-try-to-catch-every-exception-in-every-function" class="md-nav__link">
    <span class="md-ellipsis">
      E.17: Don't try to catch every exception in every function
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e18-minimize-the-use-of-explicit-trycatch" class="md-nav__link">
    <span class="md-ellipsis">
      E.18: Minimize the use of explicit try/catch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e19-use-a-final_action-object-to-express-cleanup-if-no-suitable-resource-handle-is-available" class="md-nav__link">
    <span class="md-ellipsis">
      E.19: Use a final_action object to express cleanup if no suitable resource handle is available
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e25-if-you-cant-throw-exceptions-simulate-raii-for-resource-management" class="md-nav__link">
    <span class="md-ellipsis">
      E.25: If you can't throw exceptions, simulate RAII for resource management
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e26-if-you-cant-throw-exceptions-consider-failing-fast" class="md-nav__link">
    <span class="md-ellipsis">
      E.26: If you can't throw exceptions, consider failing fast
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e27-if-you-cant-throw-exceptions-use-error-codes-systematically" class="md-nav__link">
    <span class="md-ellipsis">
      E.27: If you can't throw exceptions, use error codes systematically
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e28-avoid-error-handling-based-on-global-state-eg-errno" class="md-nav__link">
    <span class="md-ellipsis">
      E.28: Avoid error handling based on global state (e.g. errno)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e30-dont-use-exception-specifications" class="md-nav__link">
    <span class="md-ellipsis">
      E.30: Don't use exception specifications
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e31-properly-order-your-catch-clauses" class="md-nav__link">
    <span class="md-ellipsis">
      E.31: Properly order your catch-clauses
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../con-constants-and-immutability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Con: Constants and immutability
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../t-templates-and-generic-programming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    T: Templates and generic programming
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cpl-c-style-programming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CPL: C-style programming
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sf-source-files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SF: Source files
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sl-the-standard-library/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SL: The Standard Library
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../a-architectural-ideas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    A: Architectural ideas
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../nr-non-rules-and-myths/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NR: Non-Rules and myths
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../rf-references/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RF: References
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../pro-profiles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pro: Profiles
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../gsl-guidelines-support-library/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GSL: Guidelines support library
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../nl-naming-and-layout-suggestions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NL: Naming and layout suggestions
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../faq-answers-to-frequently-asked-questions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ: Answers to frequently asked questions
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix-a-libraries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Appendix A: Libraries
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix-b-modernizing-code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Appendix B: Modernizing code
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix-c-discussion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Appendix C: Discussion
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix-d-supporting-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Appendix D: Supporting tools
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../to-do-unclassified-proto-rules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    To-do: Unclassified proto-rules
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../bibliography/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bibliography
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#e1-develop-an-error-handling-strategy-early-in-a-design" class="md-nav__link">
    <span class="md-ellipsis">
      E.1: Develop an error-handling strategy early in a design
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e2-throw-an-exception-to-signal-that-a-function-cant-perform-its-assigned-task" class="md-nav__link">
    <span class="md-ellipsis">
      E.2: Throw an exception to signal that a function can't perform its assigned task
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e3-use-exceptions-for-error-handling-only" class="md-nav__link">
    <span class="md-ellipsis">
      E.3: Use exceptions for error handling only
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e4-design-your-error-handling-strategy-around-invariants" class="md-nav__link">
    <span class="md-ellipsis">
      E.4: Design your error-handling strategy around invariants
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e5-let-a-constructor-establish-an-invariant-and-throw-if-it-cannot" class="md-nav__link">
    <span class="md-ellipsis">
      E.5: Let a constructor establish an invariant, and throw if it cannot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e6-use-raii-to-prevent-leaks" class="md-nav__link">
    <span class="md-ellipsis">
      E.6: Use RAII to prevent leaks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e7-state-your-preconditions" class="md-nav__link">
    <span class="md-ellipsis">
      E.7: State your preconditions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e8-state-your-postconditions" class="md-nav__link">
    <span class="md-ellipsis">
      E.8: State your postconditions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e12-use-noexcept-when-exiting-a-function-because-of-a-throw-is-impossible-or-unacceptable" class="md-nav__link">
    <span class="md-ellipsis">
      E.12: Use noexcept when exiting a function because of a throw is impossible or unacceptable
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e13-never-throw-while-being-the-direct-owner-of-an-object" class="md-nav__link">
    <span class="md-ellipsis">
      E.13: Never throw while being the direct owner of an object
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e14-use-purpose-designed-user-defined-types-as-exceptions-not-built-in-types" class="md-nav__link">
    <span class="md-ellipsis">
      E.14: Use purpose-designed user-defined types as exceptions (not built-in types)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e15-throw-by-value-catch-exceptions-from-a-hierarchy-by-reference" class="md-nav__link">
    <span class="md-ellipsis">
      E.15: Throw by value, catch exceptions from a hierarchy by reference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e16-destructors-deallocation-swap-and-exception-type-copymove-construction-must-never-fail" class="md-nav__link">
    <span class="md-ellipsis">
      E.16: Destructors, deallocation, swap, and exception type copy/move construction must never fail
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e17-dont-try-to-catch-every-exception-in-every-function" class="md-nav__link">
    <span class="md-ellipsis">
      E.17: Don't try to catch every exception in every function
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e18-minimize-the-use-of-explicit-trycatch" class="md-nav__link">
    <span class="md-ellipsis">
      E.18: Minimize the use of explicit try/catch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e19-use-a-final_action-object-to-express-cleanup-if-no-suitable-resource-handle-is-available" class="md-nav__link">
    <span class="md-ellipsis">
      E.19: Use a final_action object to express cleanup if no suitable resource handle is available
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e25-if-you-cant-throw-exceptions-simulate-raii-for-resource-management" class="md-nav__link">
    <span class="md-ellipsis">
      E.25: If you can't throw exceptions, simulate RAII for resource management
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e26-if-you-cant-throw-exceptions-consider-failing-fast" class="md-nav__link">
    <span class="md-ellipsis">
      E.26: If you can't throw exceptions, consider failing fast
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e27-if-you-cant-throw-exceptions-use-error-codes-systematically" class="md-nav__link">
    <span class="md-ellipsis">
      E.27: If you can't throw exceptions, use error codes systematically
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e28-avoid-error-handling-based-on-global-state-eg-errno" class="md-nav__link">
    <span class="md-ellipsis">
      E.28: Avoid error handling based on global state (e.g. errno)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e30-dont-use-exception-specifications" class="md-nav__link">
    <span class="md-ellipsis">
      E.30: Don't use exception specifications
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e31-properly-order-your-catch-clauses" class="md-nav__link">
    <span class="md-ellipsis">
      E.31: Properly order your catch-clauses
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="e-error-handling-s-errors">E: Error handling {#S-errors}<a class="headerlink" href="#e-error-handling-s-errors" title="Permanent link">&para;</a></h1>
<p>Error handling involves:</p>
<ul>
<li>Detecting an error</li>
<li>Transmitting information about an error to some handler code</li>
<li>Preserving a valid state of the program</li>
<li>Avoiding resource leaks</li>
</ul>
<p>It is not possible to recover from all errors. If recovery from an error is not possible, it is important to quickly "get out" in a well-defined way. A strategy for error handling must be simple, or it becomes a source of even worse errors.  Untested and rarely executed error-handling code is itself the source of many bugs.</p>
<p>The rules are designed to help avoid several kinds of errors:</p>
<ul>
<li>Type violations (e.g., misuse of <code>union</code>s and casts)</li>
<li>Resource leaks (including memory leaks)</li>
<li>Bounds errors</li>
<li>Lifetime errors (e.g., accessing an object after it has been <code>delete</code>d)</li>
<li>Complexity errors (logical errors made likely by overly complex expression of ideas)</li>
<li>Interface errors (e.g., an unexpected value is passed through an interface)</li>
</ul>
<p>Error-handling rule summary:</p>
<ul>
<li><a href="#Re-design">E.1: Develop an error-handling strategy early in a design</a></li>
<li><a href="#Re-throw">E.2: Throw an exception to signal that a function can't perform its assigned task</a></li>
<li><a href="#Re-errors">E.3: Use exceptions for error handling only</a></li>
<li><a href="#Re-design-invariants">E.4: Design your error-handling strategy around invariants</a></li>
<li><a href="#Re-invariant">E.5: Let a constructor establish an invariant, and throw if it cannot</a></li>
<li><a href="#Re-raii">E.6: Use RAII to prevent leaks</a></li>
<li><a href="#Re-precondition">E.7: State your preconditions</a></li>
<li>
<p><a href="#Re-postcondition">E.8: State your postconditions</a></p>
</li>
<li>
<p><a href="#Re-noexcept">E.12: Use <code>noexcept</code> when exiting a function because of a <code>throw</code> is impossible or unacceptable</a></p>
</li>
<li><a href="#Re-never-throw">E.13: Never throw while being the direct owner of an object</a></li>
<li><a href="#Re-exception-types">E.14: Use purpose-designed user-defined types as exceptions (not built-in types)</a></li>
<li><a href="#Re-exception-ref">E.15: Throw by value, catch exceptions from a hierarchy by reference</a></li>
<li><a href="#Re-never-fail">E.16: Destructors, deallocation, <code>swap</code>, and exception type copy/move construction must never fail</a></li>
<li><a href="#Re-not-always">E.17: Don't try to catch every exception in every function</a></li>
<li><a href="#Re-catch">E.18: Minimize the use of explicit <code>try</code>/<code>catch</code></a></li>
<li>
<p><a href="#Re-finally">E.19: Use a <code>final_action</code> object to express cleanup if no suitable resource handle is available</a></p>
</li>
<li>
<p><a href="#Re-no-throw-raii">E.25: If you can't throw exceptions, simulate RAII for resource management</a></p>
</li>
<li><a href="#Re-no-throw-crash">E.26: If you can't throw exceptions, consider failing fast</a></li>
<li><a href="#Re-no-throw-codes">E.27: If you can't throw exceptions, use error codes systematically</a></li>
<li>
<p><a href="#Re-no-throw">E.28: Avoid error handling based on global state (e.g. <code>errno</code>)</a></p>
</li>
<li>
<p><a href="#Re-specifications">E.30: Don't use exception specifications</a></p>
</li>
<li><a href="#Re_catch">E.31: Properly order your <code>catch</code>-clauses</a></li>
</ul>
<h3 id="e1-develop-an-error-handling-strategy-early-in-a-design"><a name="Re-design"></a>E.1: Develop an error-handling strategy early in a design<a class="headerlink" href="#e1-develop-an-error-handling-strategy-early-in-a-design" title="Permanent link">&para;</a></h3>
<h5 id="reason">Reason<a class="headerlink" href="#reason" title="Permanent link">&para;</a></h5>
<p>A consistent and complete strategy for handling errors and resource leaks is hard to retrofit into a system.</p>
<h3 id="e2-throw-an-exception-to-signal-that-a-function-cant-perform-its-assigned-task"><a name="Re-throw"></a>E.2: Throw an exception to signal that a function can't perform its assigned task<a class="headerlink" href="#e2-throw-an-exception-to-signal-that-a-function-cant-perform-its-assigned-task" title="Permanent link">&para;</a></h3>
<h5 id="reason_1">Reason<a class="headerlink" href="#reason_1" title="Permanent link">&para;</a></h5>
<p>To make error handling systematic, robust, and non-repetitive.</p>
<h5 id="example">Example<a class="headerlink" href="#example" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code>struct Foo {
    vector&lt;Thing&gt; v;
    File_handle f;
    string s;
};

void use()
{
    Foo bar { {Thing{1}, Thing{2}, Thing{monkey} }, {&quot;my_file&quot;, &quot;r&quot;}, &quot;Here we go!&quot;};
    // ...
}
</code></pre></div>
<p>Here, <code>vector</code> and <code>string</code>s constructors might not be able to allocate sufficient memory for their elements, <code>vector</code>s constructor might not be able to copy the <code>Thing</code>s in its initializer list, and <code>File_handle</code> might not be able to open the required file.
In each case, they throw an exception for <code>use()</code>'s caller to handle.
If <code>use()</code> could handle the failure to construct <code>bar</code> it can take control using <code>try</code>/<code>catch</code>.
In either case, <code>Foo</code>'s constructor correctly destroys constructed members before passing control to whatever tried to create a <code>Foo</code>.
Note that there is no return value that could contain an error code.</p>
<p>The <code>File_handle</code> constructor might be defined like this:</p>
<div class="language-text highlight"><pre><span></span><code>File_handle::File_handle(const string&amp; name, const string&amp; mode)
    : f{fopen(name.c_str(), mode.c_str())}
{
    if (!f)
        throw runtime_error{&quot;File_handle: could not open &quot; + name + &quot; as &quot; + mode};
}
</code></pre></div>
<h5 id="note">Note<a class="headerlink" href="#note" title="Permanent link">&para;</a></h5>
<p>It is often said that exceptions are meant to signal exceptional events and failures.
However, that's a bit circular because "what is exceptional?"
Examples:</p>
<ul>
<li>A precondition that cannot be met</li>
<li>A constructor that cannot construct an object (failure to establish its class's <a href="#Rc-struct">invariant</a>)</li>
<li>An out-of-range error (e.g., <code>v[v.size()] = 7</code>)</li>
<li>Inability to acquire a resource (e.g., the network is down)</li>
</ul>
<p>In contrast, termination of an ordinary loop is not exceptional.
Unless the loop was meant to be infinite, termination is normal and expected.</p>
<h5 id="note_1">Note<a class="headerlink" href="#note_1" title="Permanent link">&para;</a></h5>
<p>Don't use a <code>throw</code> as simply an alternative way of returning a value from a function.</p>
<h5 id="exception">Exception<a class="headerlink" href="#exception" title="Permanent link">&para;</a></h5>
<p>Some systems, such as hard-real-time systems require a guarantee that an action is taken in a (typically short) constant maximum time known before execution starts. Such systems can use exceptions only if there is tool support for accurately predicting the maximum time to recover from a <code>throw</code>.</p>
<p><strong>See also</strong>: <a href="#Re-raii">RAII</a></p>
<p><strong>See also</strong>: <a href="#Sd-noexcept">discussion</a></p>
<h5 id="note_2">Note<a class="headerlink" href="#note_2" title="Permanent link">&para;</a></h5>
<p>Before deciding that you cannot afford or don't like exception-based error handling, have a look at the <a href="#Re-no-throw-raii">alternatives</a>;
they have their own complexities and problems.
Also, as far as possible, measure before making claims about efficiency.</p>
<h3 id="e3-use-exceptions-for-error-handling-only"><a name="Re-errors"></a>E.3: Use exceptions for error handling only<a class="headerlink" href="#e3-use-exceptions-for-error-handling-only" title="Permanent link">&para;</a></h3>
<h5 id="reason_2">Reason<a class="headerlink" href="#reason_2" title="Permanent link">&para;</a></h5>
<p>To keep error handling separated from "ordinary code."
C++ implementations tend to be optimized based on the assumption that exceptions are rare.</p>
<h5 id="example-dont">Example, don't<a class="headerlink" href="#example-dont" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code>// don&#39;t: exception not used for error handling
int find_index(vector&lt;string&gt;&amp; vec, const string&amp; x)
{
    try {
        for (gsl::index i = 0; i &lt; vec.size(); ++i)
            if (vec[i] == x) throw i;  // found x
    }
    catch (int i) {
        return i;
    }
    return -1;   // not found
}
</code></pre></div>
<p>This is more complicated and most likely runs much slower than the obvious alternative.
There is nothing exceptional about finding a value in a <code>vector</code>.</p>
<h5 id="enforcement">Enforcement<a class="headerlink" href="#enforcement" title="Permanent link">&para;</a></h5>
<p>Would need to be heuristic.
Look for exception values "leaked" out of <code>catch</code> clauses.</p>
<h3 id="e4-design-your-error-handling-strategy-around-invariants"><a name="Re-design-invariants"></a>E.4: Design your error-handling strategy around invariants<a class="headerlink" href="#e4-design-your-error-handling-strategy-around-invariants" title="Permanent link">&para;</a></h3>
<h5 id="reason_3">Reason<a class="headerlink" href="#reason_3" title="Permanent link">&para;</a></h5>
<p>To use an object it must be in a valid state (defined formally or informally by an invariant) and to recover from an error every object not destroyed must be in a valid state.</p>
<h5 id="note_3">Note<a class="headerlink" href="#note_3" title="Permanent link">&para;</a></h5>
<p>An <a href="#Rc-struct">invariant</a> is a logical condition for the members of an object that a constructor must establish for the public member functions to assume.</p>
<h5 id="enforcement_1">Enforcement<a class="headerlink" href="#enforcement_1" title="Permanent link">&para;</a></h5>
<p>???</p>
<h3 id="e5-let-a-constructor-establish-an-invariant-and-throw-if-it-cannot"><a name="Re-invariant"></a>E.5: Let a constructor establish an invariant, and throw if it cannot<a class="headerlink" href="#e5-let-a-constructor-establish-an-invariant-and-throw-if-it-cannot" title="Permanent link">&para;</a></h3>
<h5 id="reason_4">Reason<a class="headerlink" href="#reason_4" title="Permanent link">&para;</a></h5>
<p>Leaving an object without its invariant established is asking for trouble.
Not all member functions can be called.</p>
<h5 id="example_1">Example<a class="headerlink" href="#example_1" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code>class Vector {  // very simplified vector of doubles
    // if elem != nullptr then elem points to sz doubles
public:
    Vector() : elem{nullptr}, sz{0}{}
    Vector(int s) : elem{new double[s]}, sz{s} { /* initialize elements */ }
    ~Vector() { delete [] elem; }
    double&amp; operator[](int s) { return elem[s]; }
    // ...
private:
    owner&lt;double*&gt; elem;
    int sz;
};
</code></pre></div>
<p>The class invariant - here stated as a comment - is established by the constructors.
<code>new</code> throws if it cannot allocate the required memory.
The operators, notably the subscript operator, rely on the invariant.</p>
<p><strong>See also</strong>: <a href="#Rc-throw">If a constructor cannot construct a valid object, throw an exception</a></p>
<h5 id="enforcement_2">Enforcement<a class="headerlink" href="#enforcement_2" title="Permanent link">&para;</a></h5>
<p>Flag classes with <code>private</code> state without a constructor (public, protected, or private).</p>
<h3 id="e6-use-raii-to-prevent-leaks"><a name="Re-raii"></a>E.6: Use RAII to prevent leaks<a class="headerlink" href="#e6-use-raii-to-prevent-leaks" title="Permanent link">&para;</a></h3>
<h5 id="reason_5">Reason<a class="headerlink" href="#reason_5" title="Permanent link">&para;</a></h5>
<p>Leaks are typically unacceptable.
Manual resource release is error-prone.
RAII ("Resource Acquisition Is Initialization") is the simplest, most systematic way of preventing leaks.</p>
<h5 id="example_2">Example<a class="headerlink" href="#example_2" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code>void f1(int i)   // Bad: possible leak
{
    int* p = new int[12];
    // ...
    if (i &lt; 17) throw Bad{&quot;in f()&quot;, i};
    // ...
}
</code></pre></div>
<p>We could carefully release the resource before the throw:</p>
<div class="language-text highlight"><pre><span></span><code>void f2(int i)   // Clumsy and error-prone: explicit release
{
    int* p = new int[12];
    // ...
    if (i &lt; 17) {
        delete[] p;
        throw Bad{&quot;in f()&quot;, i};
    }
    // ...
}
</code></pre></div>
<p>This is verbose. In larger code with multiple possible <code>throw</code>s explicit releases become repetitive and error-prone.</p>
<div class="language-text highlight"><pre><span></span><code>void f3(int i)   // OK: resource management done by a handle (but see below)
{
    auto p = make_unique&lt;int[]&gt;(12);
    // ...
    if (i &lt; 17) throw Bad{&quot;in f()&quot;, i};
    // ...
}
</code></pre></div>
<p>Note that this works even when the <code>throw</code> is implicit because it happened in a called function:</p>
<div class="language-text highlight"><pre><span></span><code>void f4(int i)   // OK: resource management done by a handle (but see below)
{
    auto p = make_unique&lt;int[]&gt;(12);
    // ...
    helper(i);   // might throw
    // ...
}
</code></pre></div>
<p>Unless you really need pointer semantics, use a local resource object:</p>
<div class="language-text highlight"><pre><span></span><code>void f5(int i)   // OK: resource management done by local object
{
    vector&lt;int&gt; v(12);
    // ...
    helper(i);   // might throw
    // ...
}
</code></pre></div>
<p>That's even simpler and safer, and often more efficient.</p>
<h5 id="note_4">Note<a class="headerlink" href="#note_4" title="Permanent link">&para;</a></h5>
<p>If there is no obvious resource handle and for some reason defining a proper RAII object/handle is infeasible,
as a last resort, cleanup actions can be represented by a <a href="#Re-finally"><code>final_action</code></a> object.</p>
<h5 id="note_5">Note<a class="headerlink" href="#note_5" title="Permanent link">&para;</a></h5>
<p>But what do we do if we are writing a program where exceptions cannot be used?
First challenge that assumption; there are many anti-exceptions myths around.
We know of only a few good reasons:</p>
<ul>
<li>We are on a system so small that the exception support would eat up most of our 2K memory.</li>
<li>We are in a hard-real-time system and we don't have tools that guarantee us that an exception is handled within the required time.</li>
<li>We are in a system with tons of legacy code using lots of pointers in difficult-to-understand ways
  (in particular without a recognizable ownership strategy) so that exceptions could cause leaks.</li>
<li>Our implementation of the C++ exception mechanisms is unreasonably poor
(slow, memory consuming, failing to work correctly for dynamically linked libraries, etc.).
Complain to your implementation purveyor; if no user complains, no improvement will happen.</li>
<li>We get fired if we challenge our manager's ancient wisdom.</li>
</ul>
<p>Only the first of these reasons is fundamental, so whenever possible, use exceptions to implement RAII, or design your RAII objects to never fail.
When exceptions cannot be used, simulate RAII.
That is, systematically check that objects are valid after construction and still release all resources in the destructor.
One strategy is to add a <code>valid()</code> operation to every resource handle:</p>
<div class="language-text highlight"><pre><span></span><code>void f()
{
    vector&lt;string&gt; vs(100);   // not std::vector: valid() added
    if (!vs.valid()) {
        // handle error or exit
    }

    ifstream fs(&quot;foo&quot;);   // not std::ifstream: valid() added
    if (!fs.valid()) {
        // handle error or exit
    }

    // ...
} // destructors clean up as usual
</code></pre></div>
<p>Obviously, this increases the size of the code, doesn't allow for implicit propagation of "exceptions" (<code>valid()</code> checks), and <code>valid()</code> checks can be forgotten.
Prefer to use exceptions.</p>
<p><strong>See also</strong>: <a href="#Re-noexcept">Use of <code>noexcept</code></a></p>
<h5 id="enforcement_3">Enforcement<a class="headerlink" href="#enforcement_3" title="Permanent link">&para;</a></h5>
<p>???</p>
<h3 id="e7-state-your-preconditions"><a name="Re-precondition"></a>E.7: State your preconditions<a class="headerlink" href="#e7-state-your-preconditions" title="Permanent link">&para;</a></h3>
<h5 id="reason_6">Reason<a class="headerlink" href="#reason_6" title="Permanent link">&para;</a></h5>
<p>To avoid interface errors.</p>
<p><strong>See also</strong>: <a href="#Ri-pre">precondition rule</a></p>
<h3 id="e8-state-your-postconditions"><a name="Re-postcondition"></a>E.8: State your postconditions<a class="headerlink" href="#e8-state-your-postconditions" title="Permanent link">&para;</a></h3>
<h5 id="reason_7">Reason<a class="headerlink" href="#reason_7" title="Permanent link">&para;</a></h5>
<p>To avoid interface errors.</p>
<p><strong>See also</strong>: <a href="#Ri-post">postcondition rule</a></p>
<h3 id="e12-use-noexcept-when-exiting-a-function-because-of-a-throw-is-impossible-or-unacceptable"><a name="Re-noexcept"></a>E.12: Use <code>noexcept</code> when exiting a function because of a <code>throw</code> is impossible or unacceptable<a class="headerlink" href="#e12-use-noexcept-when-exiting-a-function-because-of-a-throw-is-impossible-or-unacceptable" title="Permanent link">&para;</a></h3>
<h5 id="reason_8">Reason<a class="headerlink" href="#reason_8" title="Permanent link">&para;</a></h5>
<p>To make error handling systematic, robust, and efficient.</p>
<h5 id="example_3">Example<a class="headerlink" href="#example_3" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code>double compute(double d) noexcept
{
    return log(sqrt(d &lt;= 0 ? 1 : d));
}
</code></pre></div>
<p>Here, we know that <code>compute</code> will not throw because it is composed out of operations that don't throw.
By declaring <code>compute</code> to be <code>noexcept</code>, we give the compiler and human readers information that can make it easier for them to understand and manipulate <code>compute</code>.</p>
<h5 id="note_6">Note<a class="headerlink" href="#note_6" title="Permanent link">&para;</a></h5>
<p>Many standard-library functions are <code>noexcept</code> including all the standard-library functions "inherited" from the C Standard Library.</p>
<h5 id="example_4">Example<a class="headerlink" href="#example_4" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code>vector&lt;double&gt; munge(const vector&lt;double&gt;&amp; v) noexcept
{
    vector&lt;double&gt; v2(v.size());
    // ... do something ...
}
</code></pre></div>
<p>The <code>noexcept</code> here states that I am not willing or able to handle the situation where I cannot construct the local <code>vector</code>.
That is, I consider memory exhaustion a serious design error (on par with hardware failures) so that I'm willing to crash the program if it happens.</p>
<h5 id="note_7">Note<a class="headerlink" href="#note_7" title="Permanent link">&para;</a></h5>
<p>Do not use traditional <a href="#Re-specifications">exception-specifications</a>.</p>
<h5 id="see-also">See also<a class="headerlink" href="#see-also" title="Permanent link">&para;</a></h5>
<p><a href="#Sd-noexcept">discussion</a>.</p>
<h3 id="e13-never-throw-while-being-the-direct-owner-of-an-object"><a name="Re-never-throw"></a>E.13: Never throw while being the direct owner of an object<a class="headerlink" href="#e13-never-throw-while-being-the-direct-owner-of-an-object" title="Permanent link">&para;</a></h3>
<h5 id="reason_9">Reason<a class="headerlink" href="#reason_9" title="Permanent link">&para;</a></h5>
<p>That would be a leak.</p>
<h5 id="example_5">Example<a class="headerlink" href="#example_5" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code>void leak(int x)   // don&#39;t: might leak
{
    auto p = new int{7};
    if (x &lt; 0) throw Get_me_out_of_here{};  // might leak *p
    // ...
    delete p;   // we might never get here
}
</code></pre></div>
<p>One way of avoiding such problems is to use resource handles consistently:</p>
<div class="language-text highlight"><pre><span></span><code>void no_leak(int x)
{
    auto p = make_unique&lt;int&gt;(7);
    if (x &lt; 0) throw Get_me_out_of_here{};  // will delete *p if necessary
    // ...
    // no need for delete p
}
</code></pre></div>
<p>Another solution (often better) would be to use a local variable to eliminate explicit use of pointers:</p>
<div class="language-text highlight"><pre><span></span><code>void no_leak_simplified(int x)
{
    vector&lt;int&gt; v(7);
    // ...
}
</code></pre></div>
<h5 id="note_8">Note<a class="headerlink" href="#note_8" title="Permanent link">&para;</a></h5>
<p>If you have a local "thing" that requires cleanup, but is not represented by an object with a destructor, such cleanup must
also be done before a <code>throw</code>.
Sometimes, <a href="#Re-finally"><code>finally()</code></a> can make such unsystematic cleanup a bit more manageable.</p>
<h3 id="e14-use-purpose-designed-user-defined-types-as-exceptions-not-built-in-types"><a name="Re-exception-types"></a>E.14: Use purpose-designed user-defined types as exceptions (not built-in types)<a class="headerlink" href="#e14-use-purpose-designed-user-defined-types-as-exceptions-not-built-in-types" title="Permanent link">&para;</a></h3>
<h5 id="reason_10">Reason<a class="headerlink" href="#reason_10" title="Permanent link">&para;</a></h5>
<p>A user-defined type can better transmit information about an error to a handler.  Information
can be encoded into the type itself and the type is unlikely to clash with other people's exceptions.</p>
<h5 id="example_6">Example<a class="headerlink" href="#example_6" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code>throw 7; // bad

throw &quot;something bad&quot;;  // bad

throw std::exception{}; // bad - no info
</code></pre></div>
<p>Deriving from <code>std::exception</code> gives the flexibility to catch the specific exception or handle generally through <code>std::exception</code>:</p>
<div class="language-text highlight"><pre><span></span><code>class MyException : public std::runtime_error
{
public:
    MyException(const string&amp; msg) : std::runtime_error{msg} {}
    // ...
};

// ...

throw MyException{&quot;something bad&quot;};  // good
</code></pre></div>
<p>Exceptions do not need to be derived from <code>std::exception</code>:</p>
<div class="language-text highlight"><pre><span></span><code>class MyCustomError final {};  // not derived from std::exception

// ...

throw MyCustomError{};  // good - handlers must catch this type (or ...)
</code></pre></div>
<p>Library types derived from <code>std::exception</code> can be used as generic exceptions if
no useful information can be added at the point of detection:</p>
<div class="language-text highlight"><pre><span></span><code>throw std::runtime_error(&quot;someting bad&quot;); // good

// ...

throw std::invalid_argument(&quot;i is not even&quot;); // good
</code></pre></div>
<p><code>enum</code> classes are also allowed:</p>
<div class="language-text highlight"><pre><span></span><code>enum class alert {RED, YELLOW, GREEN};

throw alert::RED; // good
</code></pre></div>
<h5 id="enforcement_4">Enforcement<a class="headerlink" href="#enforcement_4" title="Permanent link">&para;</a></h5>
<p>Catch <code>throw</code> of built-in types and <code>std::exception</code>.</p>
<h3 id="e15-throw-by-value-catch-exceptions-from-a-hierarchy-by-reference"><a name="Re-exception-ref"></a>E.15: Throw by value, catch exceptions from a hierarchy by reference<a class="headerlink" href="#e15-throw-by-value-catch-exceptions-from-a-hierarchy-by-reference" title="Permanent link">&para;</a></h3>
<h5 id="reason_11">Reason<a class="headerlink" href="#reason_11" title="Permanent link">&para;</a></h5>
<p>Throwing by value (not by pointer) and catching by reference prevents copying, especially slicing base subobjects.</p>
<h5 id="example-bad">Example; bad<a class="headerlink" href="#example-bad" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code>void f()
{
    try {
        // ...
        throw new widget{}; // don&#39;t: throw by value not by raw pointer
        // ...
    }
    catch (base_class e) {  // don&#39;t: might slice
        // ...
    }
}
</code></pre></div>
<p>Instead, use a reference:</p>
<div class="language-text highlight"><pre><span></span><code>catch (base_class&amp; e) { /* ... */ }
</code></pre></div>
<p>or - typically better still - a <code>const</code> reference:</p>
<div class="language-text highlight"><pre><span></span><code>catch (const base_class&amp; e) { /* ... */ }
</code></pre></div>
<p>Most handlers do not modify their exception and in general we <a href="#Res-const">recommend use of <code>const</code></a>.</p>
<h5 id="note_9">Note<a class="headerlink" href="#note_9" title="Permanent link">&para;</a></h5>
<p>Catch by value can be appropriate for a small value type such as an <code>enum</code> value.</p>
<h5 id="note_10">Note<a class="headerlink" href="#note_10" title="Permanent link">&para;</a></h5>
<p>To rethrow a caught exception use <code>throw;</code> not <code>throw e;</code>. Using <code>throw e;</code> would throw a new copy of <code>e</code> (sliced to the static type <code>std::exception</code>, when the exception is caught by <code>catch (const std::exception&amp; e)</code>) instead of rethrowing the original exception of type <code>std::runtime_error</code>. (But keep <a href="#Re-not-always">Don't try to catch every exception in every function</a> and <a href="#Re-catch">Minimize the use of explicit <code>try</code>/<code>catch</code></a> in mind.)</p>
<h5 id="enforcement_5">Enforcement<a class="headerlink" href="#enforcement_5" title="Permanent link">&para;</a></h5>
<ul>
<li>Flag catching by value of a type that has a virtual function.</li>
<li>Flag throwing raw pointers.</li>
</ul>
<h3 id="e16-destructors-deallocation-swap-and-exception-type-copymove-construction-must-never-fail"><a name="Re-never-fail"></a>E.16: Destructors, deallocation, <code>swap</code>, and exception type copy/move construction must never fail<a class="headerlink" href="#e16-destructors-deallocation-swap-and-exception-type-copymove-construction-must-never-fail" title="Permanent link">&para;</a></h3>
<h5 id="reason_12">Reason<a class="headerlink" href="#reason_12" title="Permanent link">&para;</a></h5>
<p>We don't know how to write reliable programs if a destructor, a swap, a memory deallocation, or attempting to copy/move-construct an exception object fails; that is, if it exits by an exception or simply doesn't perform its required action.</p>
<h5 id="example-dont_1">Example, don't<a class="headerlink" href="#example-dont_1" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code>class Connection {
    // ...
public:
    ~Connection()   // Don&#39;t: very bad destructor
    {
        if (cannot_disconnect()) throw I_give_up{information};
        // ...
    }
};
</code></pre></div>
<h5 id="note_11">Note<a class="headerlink" href="#note_11" title="Permanent link">&para;</a></h5>
<p>Many have tried to write reliable code violating this rule for examples, such as a network connection that "refuses to close".
To the best of our knowledge nobody has found a general way of doing this.
Occasionally, for very specific examples, you can get away with setting some state for future cleanup.
For example, we might put a socket that does not want to close on a "bad socket" list,
to be examined by a regular sweep of the system state.
Every example we have seen of this is error-prone, specialized, and often buggy.</p>
<h5 id="note_12">Note<a class="headerlink" href="#note_12" title="Permanent link">&para;</a></h5>
<p>The standard library assumes that destructors, deallocation functions (e.g., <code>operator delete</code>), and <code>swap</code> do not throw. If they do, basic standard-library invariants are broken.</p>
<h5 id="note_13">Note<a class="headerlink" href="#note_13" title="Permanent link">&para;</a></h5>
<ul>
<li>Deallocation functions, including <code>operator delete</code>, must be <code>noexcept</code>.</li>
<li><code>swap</code> functions must be <code>noexcept</code>.</li>
<li>Most destructors are implicitly <code>noexcept</code> by default.</li>
<li>Also, <a href="#Rc-move-noexcept">make move operations <code>noexcept</code></a>.</li>
<li>If writing a type intended to be used as an exception type, ensure its copy constructor is <code>noexcept</code>. In general we cannot mechanically enforce this, because we do not know whether a type is intended to be used as an exception type.</li>
<li>Try not to <code>throw</code> a type whose copy constructor is not <code>noexcept</code>. In general we cannot mechanically enforce this, because even <code>throw std::string(...)</code> could throw but does not in practice.</li>
</ul>
<h5 id="enforcement_6">Enforcement<a class="headerlink" href="#enforcement_6" title="Permanent link">&para;</a></h5>
<ul>
<li>Catch destructors, deallocation operations, and <code>swap</code>s that <code>throw</code>.</li>
<li>Catch such operations that are not <code>noexcept</code>.</li>
</ul>
<p><strong>See also</strong>: <a href="#Sd-never-fail">discussion</a></p>
<h3 id="e17-dont-try-to-catch-every-exception-in-every-function"><a name="Re-not-always"></a>E.17: Don't try to catch every exception in every function<a class="headerlink" href="#e17-dont-try-to-catch-every-exception-in-every-function" title="Permanent link">&para;</a></h3>
<h5 id="reason_13">Reason<a class="headerlink" href="#reason_13" title="Permanent link">&para;</a></h5>
<p>Catching an exception in a function that cannot take a meaningful recovery action leads to complexity and waste.
Let an exception propagate until it reaches a function that can handle it.
Let cleanup actions on the unwinding path be handled by <a href="#Re-raii">RAII</a>.</p>
<h5 id="example-dont_2">Example, don't<a class="headerlink" href="#example-dont_2" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code>void f()   // bad
{
    try {
        // ...
    }
    catch (...) {
        // no action
        throw;   // propagate exception
    }
}
</code></pre></div>
<h5 id="enforcement_7">Enforcement<a class="headerlink" href="#enforcement_7" title="Permanent link">&para;</a></h5>
<ul>
<li>Flag nested try-blocks.</li>
<li>Flag source code files with a too high ratio of try-blocks to functions. (??? Problem: define "too high")</li>
</ul>
<h3 id="e18-minimize-the-use-of-explicit-trycatch"><a name="Re-catch"></a>E.18: Minimize the use of explicit <code>try</code>/<code>catch</code><a class="headerlink" href="#e18-minimize-the-use-of-explicit-trycatch" title="Permanent link">&para;</a></h3>
<h5 id="reason_14">Reason<a class="headerlink" href="#reason_14" title="Permanent link">&para;</a></h5>
<p><code>try</code>/<code>catch</code> is verbose and non-trivial uses are error-prone.
 <code>try</code>/<code>catch</code> can be a sign of unsystematic and/or low-level resource management or error handling.</p>
<h5 id="example-bad_1">Example, Bad<a class="headerlink" href="#example-bad_1" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code>void f(zstring s)
{
    Gadget* p;
    try {
        p = new Gadget(s);
        // ...
        delete p;
    }
    catch (Gadget_construction_failure) {
        delete p;
        throw;
    }
}
</code></pre></div>
<p>This code is messy.
There could be a leak from the naked pointer in the <code>try</code> block.
Not all exceptions are handled.
<code>deleting</code> an object that failed to construct is almost certainly a mistake.
Better:</p>
<div class="language-text highlight"><pre><span></span><code>void f2(zstring s)
{
    Gadget g {s};
}
</code></pre></div>
<h5 id="alternatives">Alternatives<a class="headerlink" href="#alternatives" title="Permanent link">&para;</a></h5>
<ul>
<li>proper resource handles and <a href="#Re-raii">RAII</a></li>
<li><a href="#Re-finally"><code>finally</code></a></li>
</ul>
<h5 id="enforcement_8">Enforcement<a class="headerlink" href="#enforcement_8" title="Permanent link">&para;</a></h5>
<p>??? hard, needs a heuristic</p>
<h3 id="e19-use-a-final_action-object-to-express-cleanup-if-no-suitable-resource-handle-is-available"><a name="Re-finally"></a>E.19: Use a <code>final_action</code> object to express cleanup if no suitable resource handle is available<a class="headerlink" href="#e19-use-a-final_action-object-to-express-cleanup-if-no-suitable-resource-handle-is-available" title="Permanent link">&para;</a></h3>
<h5 id="reason_15">Reason<a class="headerlink" href="#reason_15" title="Permanent link">&para;</a></h5>
<p><code>finally</code> from the <a href="#gsl-guidelines-support-library">GSL</a> is less verbose and harder to get wrong than <code>try</code>/<code>catch</code>.</p>
<h5 id="example_7">Example<a class="headerlink" href="#example_7" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code>void f(int n)
{
    void* p = malloc(n);
    auto _ = gsl::finally([p] { free(p); });
    // ...
}
</code></pre></div>
<h5 id="note_14">Note<a class="headerlink" href="#note_14" title="Permanent link">&para;</a></h5>
<p><code>finally</code> is not as messy as <code>try</code>/<code>catch</code>, but it is still ad-hoc.
Prefer <a href="#Re-raii">proper resource management objects</a>.
Consider <code>finally</code> a last resort.</p>
<h5 id="note_15">Note<a class="headerlink" href="#note_15" title="Permanent link">&para;</a></h5>
<p>Use of <code>finally</code> is a systematic and reasonably clean alternative to the old <a href="#Re-no-throw-codes"><code>goto exit;</code> technique</a>
for dealing with cleanup where resource management is not systematic.</p>
<h5 id="enforcement_9">Enforcement<a class="headerlink" href="#enforcement_9" title="Permanent link">&para;</a></h5>
<p>Heuristic: Detect <code>goto exit;</code></p>
<h3 id="e25-if-you-cant-throw-exceptions-simulate-raii-for-resource-management"><a name="Re-no-throw-raii"></a>E.25: If you can't throw exceptions, simulate RAII for resource management<a class="headerlink" href="#e25-if-you-cant-throw-exceptions-simulate-raii-for-resource-management" title="Permanent link">&para;</a></h3>
<h5 id="reason_16">Reason<a class="headerlink" href="#reason_16" title="Permanent link">&para;</a></h5>
<p>Even without exceptions, <a href="#Re-raii">RAII</a> is usually the best and most systematic way of dealing with resources.</p>
<h5 id="note_16">Note<a class="headerlink" href="#note_16" title="Permanent link">&para;</a></h5>
<p>Error handling using exceptions is the only complete and systematic way of handling non-local errors in C++.
In particular, non-intrusively signaling failure to construct an object requires an exception.
Signaling errors in a way that cannot be ignored requires exceptions.
If you can't use exceptions, simulate their use as best you can.</p>
<p>A lot of fear of exceptions is misguided.
When used for exceptional circumstances in code that is not littered with pointers and complicated control structures,
exception handling is almost always affordable (in time and space) and almost always leads to better code.
This, of course, assumes a good implementation of the exception handling mechanisms, which is not available on all systems.
There are also cases where the problems above do not apply, but exceptions cannot be used for other reasons.
Some hard-real-time systems are an example: An operation has to be completed within a fixed time with an error or a correct answer.
In the absence of appropriate time estimation tools, this is hard to guarantee for exceptions.
Such systems (e.g. flight control software) typically also ban the use of dynamic (heap) memory.</p>
<p>So, the primary guideline for error handling is "use exceptions and <a href="#Re-raii">RAII</a>."
This section deals with the cases where you either do not have an efficient implementation of exceptions,
or have such a rat's nest of old-style code
(e.g., lots of pointers, ill-defined ownership, and lots of unsystematic error handling based on tests of error codes)
that it is infeasible to introduce simple and systematic exception handling.</p>
<p>Before condemning exceptions or complaining too much about their cost, consider examples of the use of <a href="#Re-no-throw-codes">error codes</a>.
Consider the cost and complexity of the use of error codes.
If performance is your worry, measure.</p>
<h5 id="example_8">Example<a class="headerlink" href="#example_8" title="Permanent link">&para;</a></h5>
<p>Assume you wanted to write</p>
<div class="language-text highlight"><pre><span></span><code>void func(zstring arg)
{
    Gadget g {arg};
    // ...
}
</code></pre></div>
<p>If the <code>gadget</code> isn't correctly constructed, <code>func</code> exits with an exception.
If we cannot throw an exception, we can simulate this RAII style of resource handling by adding a <code>valid()</code> member function to <code>Gadget</code>:</p>
<div class="language-text highlight"><pre><span></span><code>error_indicator func(zstring arg)
{
    Gadget g {arg};
    if (!g.valid()) return gadget_construction_error;
    // ...
    return 0;   // zero indicates &quot;good&quot;
}
</code></pre></div>
<p>The problem is of course that the caller now has to remember to test the return value. To encourage doing so, consider adding a <code>[[nodiscard]]</code>.</p>
<p><strong>See also</strong>: <a href="#Sd-???">Discussion</a></p>
<h5 id="enforcement_10">Enforcement<a class="headerlink" href="#enforcement_10" title="Permanent link">&para;</a></h5>
<p>Possible (only) for specific versions of this idea: e.g., test for systematic test of <code>valid()</code> after resource handle construction</p>
<h3 id="e26-if-you-cant-throw-exceptions-consider-failing-fast"><a name="Re-no-throw-crash"></a>E.26: If you can't throw exceptions, consider failing fast<a class="headerlink" href="#e26-if-you-cant-throw-exceptions-consider-failing-fast" title="Permanent link">&para;</a></h3>
<h5 id="reason_17">Reason<a class="headerlink" href="#reason_17" title="Permanent link">&para;</a></h5>
<p>If you can't do a good job at recovering, at least you can get out before too much consequential damage is done.</p>
<p><strong>See also</strong>: <a href="#Re-no-throw-raii">Simulating RAII</a></p>
<h5 id="note_17">Note<a class="headerlink" href="#note_17" title="Permanent link">&para;</a></h5>
<p>If you cannot be systematic about error handling, consider "crashing" as a response to any error that cannot be handled locally.
That is, if you cannot recover from an error in the context of the function that detected it, call <code>abort()</code>, <code>quick_exit()</code>,
or a similar function that will trigger some sort of system restart.</p>
<p>In systems where you have lots of processes and/or lots of computers, you need to expect and handle fatal crashes anyway,
say from hardware failures.
In such cases, "crashing" is simply leaving error handling to the next level of the system.</p>
<h5 id="example_9">Example<a class="headerlink" href="#example_9" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code>void f(int n)
{
    // ...
    p = static_cast&lt;X*&gt;(malloc(n * sizeof(X)));
    if (!p) abort();     // abort if memory is exhausted
    // ...
}
</code></pre></div>
<p>Most programs cannot handle memory exhaustion gracefully anyway. This is roughly equivalent to</p>
<div class="language-text highlight"><pre><span></span><code>void f(int n)
{
    // ...
    p = new X[n];    // throw if memory is exhausted (by default, terminate)
    // ...
}
</code></pre></div>
<p>Typically, it is a good idea to log the reason for the "crash" before exiting.</p>
<h5 id="enforcement_11">Enforcement<a class="headerlink" href="#enforcement_11" title="Permanent link">&para;</a></h5>
<p>Awkward</p>
<h3 id="e27-if-you-cant-throw-exceptions-use-error-codes-systematically"><a name="Re-no-throw-codes"></a>E.27: If you can't throw exceptions, use error codes systematically<a class="headerlink" href="#e27-if-you-cant-throw-exceptions-use-error-codes-systematically" title="Permanent link">&para;</a></h3>
<h5 id="reason_18">Reason<a class="headerlink" href="#reason_18" title="Permanent link">&para;</a></h5>
<p>Systematic use of any error-handling strategy minimizes the chance of forgetting to handle an error.</p>
<p><strong>See also</strong>: <a href="#Re-no-throw-raii">Simulating RAII</a></p>
<h5 id="note_18">Note<a class="headerlink" href="#note_18" title="Permanent link">&para;</a></h5>
<p>There are several issues to be addressed:</p>
<ul>
<li>How do you transmit an error indicator from out of a function?</li>
<li>How do you release all resources from a function before doing an error exit?</li>
<li>What do you use as an error indicator?</li>
</ul>
<p>In general, returning an error indicator implies returning two values: The result and an error indicator.
The error indicator can be part of the object, e.g. an object can have a <code>valid()</code> indicator
or a pair of values can be returned.</p>
<h5 id="example_10">Example<a class="headerlink" href="#example_10" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code>Gadget make_gadget(int n)
{
    // ...
}

void user()
{
    Gadget g = make_gadget(17);
    if (!g.valid()) {
            // error handling
    }
    // ...
}
</code></pre></div>
<p>This approach fits with <a href="#Re-no-throw-raii">simulated RAII resource management</a>.
The <code>valid()</code> function could return an <code>error_indicator</code> (e.g. a member of an <code>error_indicator</code> enumeration).</p>
<h5 id="example_11">Example<a class="headerlink" href="#example_11" title="Permanent link">&para;</a></h5>
<p>What if we cannot or do not want to modify the <code>Gadget</code> type?
In that case, we must return a pair of values.
For example:</p>
<div class="language-text highlight"><pre><span></span><code>std::pair&lt;Gadget, error_indicator&gt; make_gadget(int n)
{
    // ...
}

void user()
{
    auto r = make_gadget(17);
    if (!r.second) {
            // error handling
    }
    Gadget&amp; g = r.first;
    // ...
}
</code></pre></div>
<p>As shown, <code>std::pair</code> is a possible return type.
Some people prefer a specific type.
For example:</p>
<div class="language-text highlight"><pre><span></span><code>Gval make_gadget(int n)
{
    // ...
}

void user()
{
    auto r = make_gadget(17);
    if (!r.err) {
            // error handling
    }
    Gadget&amp; g = r.val;
    // ...
}
</code></pre></div>
<p>One reason to prefer a specific return type is to have names for its members, rather than the somewhat cryptic <code>first</code> and <code>second</code>
and to avoid confusion with other uses of <code>std::pair</code>.</p>
<h5 id="example_12">Example<a class="headerlink" href="#example_12" title="Permanent link">&para;</a></h5>
<p>In general, you must clean up before an error exit.
This can be messy:</p>
<div class="language-text highlight"><pre><span></span><code>std::pair&lt;int, error_indicator&gt; user()
{
    Gadget g1 = make_gadget(17);
    if (!g1.valid()) {
        return {0, g1_error};
    }

    Gadget g2 = make_gadget(31);
    if (!g2.valid()) {
        cleanup(g1);
        return {0, g2_error};
    }

    // ...

    if (all_foobar(g1, g2)) {
        cleanup(g2);
        cleanup(g1);
        return {0, foobar_error};
    }

    // ...

    cleanup(g2);
    cleanup(g1);
    return {res, 0};
}
</code></pre></div>
<p>Simulating RAII can be non-trivial, especially in functions with multiple resources and multiple possible errors.
A not uncommon technique is to gather cleanup at the end of the function to avoid repetition (note that the extra scope around <code>g2</code> is undesirable but necessary to make the <code>goto</code> version compile):</p>
<div class="language-text highlight"><pre><span></span><code>std::pair&lt;int, error_indicator&gt; user()
{
    error_indicator err = 0;
    int res = 0;

    Gadget g1 = make_gadget(17);
    if (!g1.valid()) {
        err = g1_error;
        goto g1_exit;
    }

    {
        Gadget g2 = make_gadget(31);
        if (!g2.valid()) {
            err = g2_error;
            goto g2_exit;
        }

        if (all_foobar(g1, g2)) {
            err = foobar_error;
            goto g2_exit;
        }

        // ...

    g2_exit:
        if (g2.valid()) cleanup(g2);
    }

g1_exit:
    if (g1.valid()) cleanup(g1);
    return {res, err};
}
</code></pre></div>
<p>The larger the function, the more tempting this technique becomes.
<code>finally</code> can <a href="#Re-finally">ease the pain a bit</a>.
Also, the larger the program becomes the harder it is to apply an error-indicator-based error-handling strategy systematically.</p>
<p>We <a href="#Re-throw">prefer exception-based error handling</a> and recommend <a href="#Rf-single">keeping functions short</a>.</p>
<p><strong>See also</strong>: <a href="#Sd-???">Discussion</a></p>
<p><strong>See also</strong>: <a href="#Rf-out-multi">Returning multiple values</a></p>
<h5 id="enforcement_12">Enforcement<a class="headerlink" href="#enforcement_12" title="Permanent link">&para;</a></h5>
<p>Awkward.</p>
<h3 id="e28-avoid-error-handling-based-on-global-state-eg-errno"><a name="Re-no-throw"></a>E.28: Avoid error handling based on global state (e.g. <code>errno</code>)<a class="headerlink" href="#e28-avoid-error-handling-based-on-global-state-eg-errno" title="Permanent link">&para;</a></h3>
<h5 id="reason_19">Reason<a class="headerlink" href="#reason_19" title="Permanent link">&para;</a></h5>
<p>Global state is hard to manage and it is easy to forget to check it.
When did you last test the return value of <code>printf()</code>?</p>
<p><strong>See also</strong>: <a href="#Re-no-throw-raii">Simulating RAII</a></p>
<h5 id="example-bad_2">Example, bad<a class="headerlink" href="#example-bad_2" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code>int last_err;

void f(int n)
{
    // ...
    p = static_cast&lt;X*&gt;(malloc(n * sizeof(X)));
    if (!p) last_err = -1;     // error if memory is exhausted
    // ...
}
</code></pre></div>
<h5 id="note_19">Note<a class="headerlink" href="#note_19" title="Permanent link">&para;</a></h5>
<p>C-style error handling is based on the global variable <code>errno</code>, so it is essentially impossible to avoid this style completely.</p>
<h5 id="enforcement_13">Enforcement<a class="headerlink" href="#enforcement_13" title="Permanent link">&para;</a></h5>
<p>Awkward.</p>
<h3 id="e30-dont-use-exception-specifications"><a name="Re-specifications"></a>E.30: Don't use exception specifications<a class="headerlink" href="#e30-dont-use-exception-specifications" title="Permanent link">&para;</a></h3>
<h5 id="reason_20">Reason<a class="headerlink" href="#reason_20" title="Permanent link">&para;</a></h5>
<p>Exception specifications make error handling brittle, impose a run-time cost, and have been removed from the C++ standard.</p>
<h5 id="example_13">Example<a class="headerlink" href="#example_13" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code>int use(int arg)
    throw(X, Y)
{
    // ...
    auto x = f(arg);
    // ...
}
</code></pre></div>
<p>If <code>f()</code> throws an exception different from <code>X</code> and <code>Y</code> the unexpected handler is invoked, which by default terminates.
That's OK, but say that we have checked that this cannot happen and <code>f</code> is changed to throw a new exception <code>Z</code>,
we now have a crash on our hands unless we change <code>use()</code> (and re-test everything).
The snag is that <code>f()</code> might be in a library we do not control and the new exception is not anything that <code>use()</code> can do
anything about or is in any way interested in.
We can change <code>use()</code> to pass <code>Z</code> through, but now <code>use()</code>'s callers probably need to be modified.
This quickly becomes unmanageable.
Alternatively, we can add a <code>try</code>-<code>catch</code> to <code>use()</code> to map <code>Z</code> into an acceptable exception.
This too, quickly becomes unmanageable.
Note that changes to the set of exceptions often happens at the lowest level of a system
(e.g., because of changes to a network library or some middleware), so changes "bubble up" through long call chains.
In a large code base, this could mean that nobody could update to a new version of a library until the last user was modified.
If <code>use()</code> is part of a library, it might not be possible to update it because a change could affect unknown clients.</p>
<p>The policy of letting exceptions propagate until they reach a function that potentially can handle it has proven itself over the years.</p>
<h5 id="note_20">Note<a class="headerlink" href="#note_20" title="Permanent link">&para;</a></h5>
<p>No. This would not be any better had exception specifications been statically enforced.
For example, see <a href="#Stroustrup94">Stroustrup94</a>.</p>
<h5 id="note_21">Note<a class="headerlink" href="#note_21" title="Permanent link">&para;</a></h5>
<p>If no exception can be thrown, use <a href="#Re-noexcept"><code>noexcept</code></a>.</p>
<h5 id="enforcement_14">Enforcement<a class="headerlink" href="#enforcement_14" title="Permanent link">&para;</a></h5>
<p>Flag every exception specification.</p>
<h3 id="e31-properly-order-your-catch-clauses"><a name="Re_catch"></a>E.31: Properly order your <code>catch</code>-clauses<a class="headerlink" href="#e31-properly-order-your-catch-clauses" title="Permanent link">&para;</a></h3>
<h5 id="reason_21">Reason<a class="headerlink" href="#reason_21" title="Permanent link">&para;</a></h5>
<p><code>catch</code>-clauses are evaluated in the order they appear and one clause can hide another.</p>
<h5 id="example-bad_3">Example, bad<a class="headerlink" href="#example-bad_3" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code>void f()
{
    // ...
    try {
            // ...
    }
    catch (Base&amp; b) { /* ... */ }
    catch (Derived&amp; d) { /* ... */ }
    catch (...) { /* ... */ }
    catch (std::exception&amp; e) { /* ... */ }
}
</code></pre></div>
<p>If <code>Derived</code>is derived from <code>Base</code> the <code>Derived</code>-handler will never be invoked.
The "catch everything" handler ensured that the <code>std::exception</code>-handler will never be invoked.</p>
<h5 id="enforcement_15">Enforcement<a class="headerlink" href="#enforcement_15" title="Permanent link">&para;</a></h5>
<p>Flag all "hiding handlers".</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="../js/open_in_new_tab.js"></script>
      
    
  </body>
</html>