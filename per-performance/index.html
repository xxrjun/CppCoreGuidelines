
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../es-expressions-and-statements/">
      
      
        <link rel="next" href="../cp-concurrency-and-parallelism/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>Per: Performance - C++ Core Guidelines</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#per-performance-s-performance" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="C++ Core Guidelines" class="md-header__button md-logo" aria-label="C++ Core Guidelines" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            C++ Core Guidelines
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Per: Performance
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/xxrjun/CppCoreGuidelines" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    xxrjun/CppCoreGuidelines
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="C++ Core Guidelines" class="md-nav__button md-logo" aria-label="C++ Core Guidelines" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    C++ Core Guidelines
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/xxrjun/CppCoreGuidelines" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    xxrjun/CppCoreGuidelines
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../NOTICE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NOTICE
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../abstract/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Abstract
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../in-introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    In: Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../p-philosophy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    P: Philosophy
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../i-interfaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    I: Interfaces
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../f-functions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    F: Functions
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../c-classes-and-class-hierarchies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C: Classes and class hierarchies
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../enum-enumerations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Enum: Enumerations
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../r-resource-management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    R: Resource management
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../es-expressions-and-statements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ES: Expressions and statements
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Per: Performance
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Per: Performance
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#per1-dont-optimize-without-reason" class="md-nav__link">
    <span class="md-ellipsis">
      Per.1: Don't optimize without reason
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per2-dont-optimize-prematurely" class="md-nav__link">
    <span class="md-ellipsis">
      Per.2: Don't optimize prematurely
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per3-dont-optimize-something-thats-not-performance-critical" class="md-nav__link">
    <span class="md-ellipsis">
      Per.3: Don't optimize something that's not performance critical
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per4-dont-assume-that-complicated-code-is-necessarily-faster-than-simple-code" class="md-nav__link">
    <span class="md-ellipsis">
      Per.4: Don't assume that complicated code is necessarily faster than simple code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per5-dont-assume-that-low-level-code-is-necessarily-faster-than-high-level-code" class="md-nav__link">
    <span class="md-ellipsis">
      Per.5: Don't assume that low-level code is necessarily faster than high-level code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per6-dont-make-claims-about-performance-without-measurements" class="md-nav__link">
    <span class="md-ellipsis">
      Per.6: Don't make claims about performance without measurements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per7-design-to-enable-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Per.7: Design to enable optimization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per10-rely-on-the-static-type-system" class="md-nav__link">
    <span class="md-ellipsis">
      Per.10: Rely on the static type system
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per11-move-computation-from-run-time-to-compile-time" class="md-nav__link">
    <span class="md-ellipsis">
      Per.11: Move computation from run time to compile time
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per12-eliminate-redundant-aliases" class="md-nav__link">
    <span class="md-ellipsis">
      Per.12: Eliminate redundant aliases
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per13-eliminate-redundant-indirections" class="md-nav__link">
    <span class="md-ellipsis">
      Per.13: Eliminate redundant indirections
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per14-minimize-the-number-of-allocations-and-deallocations" class="md-nav__link">
    <span class="md-ellipsis">
      Per.14: Minimize the number of allocations and deallocations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per15-do-not-allocate-on-a-critical-branch" class="md-nav__link">
    <span class="md-ellipsis">
      Per.15: Do not allocate on a critical branch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per16-use-compact-data-structures" class="md-nav__link">
    <span class="md-ellipsis">
      Per.16: Use compact data structures
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per17-declare-the-most-used-member-of-a-time-critical-struct-first" class="md-nav__link">
    <span class="md-ellipsis">
      Per.17: Declare the most used member of a time-critical struct first
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per18-space-is-time" class="md-nav__link">
    <span class="md-ellipsis">
      Per.18: Space is time
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per19-access-memory-predictably" class="md-nav__link">
    <span class="md-ellipsis">
      Per.19: Access memory predictably
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per30-avoid-context-switches-on-the-critical-path" class="md-nav__link">
    <span class="md-ellipsis">
      Per.30: Avoid context switches on the critical path
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cp-concurrency-and-parallelism/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CP: Concurrency and parallelism
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../e-error-handling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    E: Error handling
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../con-constants-and-immutability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Con: Constants and immutability
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../t-templates-and-generic-programming/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T: Templates and generic programming
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cpl-c-style-programming/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CPL: C-style programming
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sf-source-files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SF: Source files
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sl-the-standard-library/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SL: The Standard Library
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../a-architectural-ideas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A: Architectural ideas
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../nr-non-rules-and-myths/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NR: Non-Rules and myths
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../rf-references/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RF: References
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../pro-profiles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pro: Profiles
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../gsl-guidelines-support-library/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GSL: Guidelines support library
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../nl-naming-and-layout-suggestions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NL: Naming and layout suggestions
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../faq-answers-to-frequently-asked-questions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ: Answers to frequently asked questions
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix-a-libraries/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Appendix A: Libraries
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix-b-modernizing-code/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Appendix B: Modernizing code
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix-c-discussion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Appendix C: Discussion
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix-d-supporting-tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Appendix D: Supporting tools
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../glossary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../to-do-unclassified-proto-rules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    To-do: Unclassified proto-rules
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../bibliography/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bibliography
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#per1-dont-optimize-without-reason" class="md-nav__link">
    <span class="md-ellipsis">
      Per.1: Don't optimize without reason
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per2-dont-optimize-prematurely" class="md-nav__link">
    <span class="md-ellipsis">
      Per.2: Don't optimize prematurely
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per3-dont-optimize-something-thats-not-performance-critical" class="md-nav__link">
    <span class="md-ellipsis">
      Per.3: Don't optimize something that's not performance critical
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per4-dont-assume-that-complicated-code-is-necessarily-faster-than-simple-code" class="md-nav__link">
    <span class="md-ellipsis">
      Per.4: Don't assume that complicated code is necessarily faster than simple code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per5-dont-assume-that-low-level-code-is-necessarily-faster-than-high-level-code" class="md-nav__link">
    <span class="md-ellipsis">
      Per.5: Don't assume that low-level code is necessarily faster than high-level code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per6-dont-make-claims-about-performance-without-measurements" class="md-nav__link">
    <span class="md-ellipsis">
      Per.6: Don't make claims about performance without measurements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per7-design-to-enable-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Per.7: Design to enable optimization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per10-rely-on-the-static-type-system" class="md-nav__link">
    <span class="md-ellipsis">
      Per.10: Rely on the static type system
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per11-move-computation-from-run-time-to-compile-time" class="md-nav__link">
    <span class="md-ellipsis">
      Per.11: Move computation from run time to compile time
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per12-eliminate-redundant-aliases" class="md-nav__link">
    <span class="md-ellipsis">
      Per.12: Eliminate redundant aliases
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per13-eliminate-redundant-indirections" class="md-nav__link">
    <span class="md-ellipsis">
      Per.13: Eliminate redundant indirections
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per14-minimize-the-number-of-allocations-and-deallocations" class="md-nav__link">
    <span class="md-ellipsis">
      Per.14: Minimize the number of allocations and deallocations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per15-do-not-allocate-on-a-critical-branch" class="md-nav__link">
    <span class="md-ellipsis">
      Per.15: Do not allocate on a critical branch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per16-use-compact-data-structures" class="md-nav__link">
    <span class="md-ellipsis">
      Per.16: Use compact data structures
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per17-declare-the-most-used-member-of-a-time-critical-struct-first" class="md-nav__link">
    <span class="md-ellipsis">
      Per.17: Declare the most used member of a time-critical struct first
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per18-space-is-time" class="md-nav__link">
    <span class="md-ellipsis">
      Per.18: Space is time
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per19-access-memory-predictably" class="md-nav__link">
    <span class="md-ellipsis">
      Per.19: Access memory predictably
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per30-avoid-context-switches-on-the-critical-path" class="md-nav__link">
    <span class="md-ellipsis">
      Per.30: Avoid context switches on the critical path
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="per-performance-s-performance">Per: Performance {#S-performance}<a class="headerlink" href="#per-performance-s-performance" title="Permanent link">&para;</a></h1>
<p>??? should this section be in the main guide???</p>
<p>This section contains rules for people who need high performance or low-latency.
That is, these are rules that relate to how to use as little time and as few resources as possible to achieve a task in a predictably short time.
The rules in this section are more restrictive and intrusive than what is needed for many (most) applications.
Do not na√Øvely try to follow them in general code: achieving the goals of low latency requires extra work.</p>
<p>Performance rule summary:</p>
<ul>
<li><a href="#Rper-reason">Per.1: Don't optimize without reason</a></li>
<li><a href="#Rper-Knuth">Per.2: Don't optimize prematurely</a></li>
<li><a href="#Rper-critical">Per.3: Don't optimize something that's not performance critical</a></li>
<li><a href="#Rper-simple">Per.4: Don't assume that complicated code is necessarily faster than simple code</a></li>
<li><a href="#Rper-low">Per.5: Don't assume that low-level code is necessarily faster than high-level code</a></li>
<li><a href="#Rper-measure">Per.6: Don't make claims about performance without measurements</a></li>
<li><a href="#Rper-efficiency">Per.7: Design to enable optimization</a></li>
<li><a href="#Rper-type">Per.10: Rely on the static type system</a></li>
<li><a href="#Rper-Comp">Per.11: Move computation from run time to compile time</a></li>
<li><a href="#Rper-alias">Per.12: Eliminate redundant aliases</a></li>
<li><a href="#Rper-indirect">Per.13: Eliminate redundant indirections</a></li>
<li><a href="#Rper-alloc">Per.14: Minimize the number of allocations and deallocations</a></li>
<li><a href="#Rper-alloc0">Per.15: Do not allocate on a critical branch</a></li>
<li><a href="#Rper-compact">Per.16: Use compact data structures</a></li>
<li><a href="#Rper-struct">Per.17: Declare the most used member of a time-critical struct first</a></li>
<li><a href="#Rper-space">Per.18: Space is time</a></li>
<li><a href="#Rper-access">Per.19: Access memory predictably</a></li>
<li><a href="#Rper-context">Per.30: Avoid context switches on the critical path</a></li>
</ul>
<h3 id="per1-dont-optimize-without-reason"><a name="Rper-reason"></a>Per.1: Don't optimize without reason<a class="headerlink" href="#per1-dont-optimize-without-reason" title="Permanent link">&para;</a></h3>
<h5 id="reason">Reason<a class="headerlink" href="#reason" title="Permanent link">&para;</a></h5>
<p>If there is no need for optimization, the main result of the effort will be more errors and higher maintenance costs.</p>
<h5 id="note">Note<a class="headerlink" href="#note" title="Permanent link">&para;</a></h5>
<p>Some people optimize out of habit or because it's fun.</p>
<p>???</p>
<h3 id="per2-dont-optimize-prematurely"><a name="Rper-Knuth"></a>Per.2: Don't optimize prematurely<a class="headerlink" href="#per2-dont-optimize-prematurely" title="Permanent link">&para;</a></h3>
<h5 id="reason_1">Reason<a class="headerlink" href="#reason_1" title="Permanent link">&para;</a></h5>
<p>Elaborately optimized code is usually larger and harder to change than unoptimized code.</p>
<p>???</p>
<h3 id="per3-dont-optimize-something-thats-not-performance-critical"><a name="Rper-critical"></a>Per.3: Don't optimize something that's not performance critical<a class="headerlink" href="#per3-dont-optimize-something-thats-not-performance-critical" title="Permanent link">&para;</a></h3>
<h5 id="reason_2">Reason<a class="headerlink" href="#reason_2" title="Permanent link">&para;</a></h5>
<p>Optimizing a non-performance-critical part of a program has no effect on system performance.</p>
<h5 id="note_1">Note<a class="headerlink" href="#note_1" title="Permanent link">&para;</a></h5>
<p>If your program spends most of its time waiting for the web or for a human, optimization of in-memory computation is probably useless.</p>
<p>Put another way: If your program spends 4% of its processing time doing
computation A and 40% of its time doing computation B, a 50% improvement on A is
only as impactful as a 5% improvement on B. (If you don't even know how much
time is spent on A or B, see <a href="#Rper-reason">Per.1</a> and <a
href="#Rper-Knuth">Per.2</a>.)</p>
<h3 id="per4-dont-assume-that-complicated-code-is-necessarily-faster-than-simple-code"><a name="Rper-simple"></a>Per.4: Don't assume that complicated code is necessarily faster than simple code<a class="headerlink" href="#per4-dont-assume-that-complicated-code-is-necessarily-faster-than-simple-code" title="Permanent link">&para;</a></h3>
<h5 id="reason_3">Reason<a class="headerlink" href="#reason_3" title="Permanent link">&para;</a></h5>
<p>Simple code can be very fast. Optimizers sometimes do marvels with simple code</p>
<h5 id="example-good">Example, good<a class="headerlink" href="#example-good" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code>// clear expression of intent, fast execution

vector&lt;uint8_t&gt; v(100000);

for (auto&amp; c : v)
    c = ~c;
</code></pre></div>
<h5 id="example-bad">Example, bad<a class="headerlink" href="#example-bad" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code>// intended to be faster, but is often slower

vector&lt;uint8_t&gt; v(100000);

for (size_t i = 0; i &lt; v.size(); i += sizeof(uint64_t)) {
    uint64_t&amp; quad_word = *reinterpret_cast&lt;uint64_t*&gt;(&amp;v[i]);
    quad_word = ~quad_word;
}
</code></pre></div>
<h5 id="note_2">Note<a class="headerlink" href="#note_2" title="Permanent link">&para;</a></h5>
<p>???</p>
<p>???</p>
<h3 id="per5-dont-assume-that-low-level-code-is-necessarily-faster-than-high-level-code"><a name="Rper-low"></a>Per.5: Don't assume that low-level code is necessarily faster than high-level code<a class="headerlink" href="#per5-dont-assume-that-low-level-code-is-necessarily-faster-than-high-level-code" title="Permanent link">&para;</a></h3>
<h5 id="reason_4">Reason<a class="headerlink" href="#reason_4" title="Permanent link">&para;</a></h5>
<p>Low-level code sometimes inhibits optimizations. Optimizers sometimes do marvels with high-level code.</p>
<h5 id="note_3">Note<a class="headerlink" href="#note_3" title="Permanent link">&para;</a></h5>
<p>???</p>
<p>???</p>
<h3 id="per6-dont-make-claims-about-performance-without-measurements"><a name="Rper-measure"></a>Per.6: Don't make claims about performance without measurements<a class="headerlink" href="#per6-dont-make-claims-about-performance-without-measurements" title="Permanent link">&para;</a></h3>
<h5 id="reason_5">Reason<a class="headerlink" href="#reason_5" title="Permanent link">&para;</a></h5>
<p>The field of performance is littered with myth and bogus folklore.
Modern hardware and optimizers defy naive assumptions; even experts are regularly surprised.</p>
<h5 id="note_4">Note<a class="headerlink" href="#note_4" title="Permanent link">&para;</a></h5>
<p>Getting good performance measurements can be hard and require specialized tools.</p>
<h5 id="note_5">Note<a class="headerlink" href="#note_5" title="Permanent link">&para;</a></h5>
<p>A few simple microbenchmarks using Unix <code>time</code> or the standard-library <code>&lt;chrono&gt;</code> can help dispel the most obvious myths.
If you can't measure your complete system accurately, at least try to measure a few of your key operations and algorithms.
A profiler can help tell you which parts of your system are performance critical.
Often, you will be surprised.</p>
<p>???</p>
<h3 id="per7-design-to-enable-optimization"><a name="Rper-efficiency"></a>Per.7: Design to enable optimization<a class="headerlink" href="#per7-design-to-enable-optimization" title="Permanent link">&para;</a></h3>
<h5 id="reason_6">Reason<a class="headerlink" href="#reason_6" title="Permanent link">&para;</a></h5>
<p>Because we often need to optimize the initial design.
Because a design that ignores the possibility of later improvement is hard to change.</p>
<h5 id="example">Example<a class="headerlink" href="#example" title="Permanent link">&para;</a></h5>
<p>From the C (and C++) standard:</p>
<div class="language-text highlight"><pre><span></span><code>void qsort (void* base, size_t num, size_t size, int (*compar)(const void*, const void*));
</code></pre></div>
<p>When did you even want to sort memory?
Really, we sort sequences of elements, typically stored in containers.
A call to <code>qsort</code> throws away much useful information (e.g., the element type), forces the user to repeat information
already known (e.g., the element size), and forces the user to write extra code (e.g., a function to compare <code>double</code>s).
This implies added work for the programmer, is error-prone, and deprives the compiler of information needed for optimization.</p>
<div class="language-text highlight"><pre><span></span><code>double data[100];
// ... fill a ...

// 100 chunks of memory of sizeof(double) starting at
// address data using the order defined by compare_doubles
qsort(data, 100, sizeof(double), compare_doubles);
</code></pre></div>
<p>From the point of view of interface design, <code>qsort</code> throws away useful information.</p>
<p>We can do better (in C++98)</p>
<div class="language-text highlight"><pre><span></span><code>template&lt;typename Iter&gt;
    void sort(Iter b, Iter e);  // sort [b:e)

sort(data, data + 100);
</code></pre></div>
<p>Here, we use the compiler's knowledge about the size of the array, the type of elements, and how to compare <code>double</code>s.</p>
<p>With C++20, we can do better still</p>
<div class="language-text highlight"><pre><span></span><code>// sortable specifies that c must be a
// random-access sequence of elements comparable with &lt;
void sort(sortable auto&amp; c);

sort(c);
</code></pre></div>
<p>The key is to pass sufficient information for a good implementation to be chosen.
In this, the <code>sort</code> interfaces shown here still have a weakness:
They implicitly rely on the element type having less-than (<code>&lt;</code>) defined.
To complete the interface, we need a second version that accepts a comparison criterion:</p>
<div class="language-text highlight"><pre><span></span><code>// compare elements of c using r
template&lt;random_access_range R, class C&gt; requires sortable&lt;R, C&gt;
void sort(R&amp;&amp; r, C c);
</code></pre></div>
<p>The standard-library specification of <code>sort</code> offers those two versions, and more.</p>
<h5 id="note_6">Note<a class="headerlink" href="#note_6" title="Permanent link">&para;</a></h5>
<p>Premature optimization is said to be <a href="#Rper-Knuth">the root of all evil</a>, but that's not a reason to despise performance.
It is never premature to consider what makes a design amenable to improvement, and improved performance is a commonly desired improvement.
Aim to build a set of habits that by default results in efficient, maintainable, and optimizable code.
In particular, when you write a function that is not a one-off implementation detail, consider</p>
<ul>
<li>Information passing:
Prefer clean <a href="#S-interfaces">interfaces</a> carrying sufficient information for later improvement of implementation.
Note that information flows into and out of an implementation through the interfaces we provide.</li>
<li>Compact data: By default, <a href="#Rper-compact">use compact data</a>, such as <code>std::vector</code> and <a href="#Rper-access">access it in a systematic fashion</a>.
If you think you need a linked structure, try to craft the interface so that this structure isn't seen by users.</li>
<li>Function argument passing and return:
Distinguish between mutable and non-mutable data.
Don't impose a resource management burden on your users.
Don't impose spurious run-time indirections on your users.
Use <a href="#Rf-conventional">conventional ways</a> of passing information through an interface;
unconventional and/or "optimized" ways of passing data can seriously complicate later reimplementation.</li>
<li>Abstraction:
Don't overgeneralize; a design that tries to cater for every possible use (and misuse) and defers every design decision for later
(using compile-time or run-time indirections) is usually a complicated, bloated, hard-to-understand mess.
Generalize from concrete examples, preserving performance as we generalize.
Do not generalize based on mere speculation about future needs.
The ideal is zero-overhead generalization.</li>
<li>Libraries:
Use libraries with good interfaces.
If no library is available build one yourself and imitate the interface style from a good library.
The <a href="#sl-the-standard-library">standard library</a> is a good first place to look for inspiration.</li>
<li>Isolation:
Isolate your code from messy and/or old-style code by providing an interface of your choosing to it.
This is sometimes called "providing a wrapper" for the useful/necessary but messy code.
Don't let bad designs "bleed into" your code.</li>
</ul>
<h5 id="example_1">Example<a class="headerlink" href="#example_1" title="Permanent link">&para;</a></h5>
<p>Consider:</p>
<div class="language-text highlight"><pre><span></span><code>template&lt;class ForwardIterator, class T&gt;
bool binary_search(ForwardIterator first, ForwardIterator last, const T&amp; val);
</code></pre></div>
<p><code>binary_search(begin(c), end(c), 7)</code> will tell you whether <code>7</code> is in <code>c</code> or not.
However, it will not tell you where that <code>7</code> is or whether there are more than one <code>7</code>.</p>
<p>Sometimes, just passing the minimal amount of information back (here, <code>true</code> or <code>false</code>) is sufficient, but a good interface passes
needed information back to the caller. Therefore, the standard library also offers</p>
<div class="language-text highlight"><pre><span></span><code>template&lt;class ForwardIterator, class T&gt;
ForwardIterator lower_bound(ForwardIterator first, ForwardIterator last, const T&amp; val);
</code></pre></div>
<p><code>lower_bound</code> returns an iterator to the first match if any, otherwise to the first element greater than <code>val</code>, or <code>last</code> if no such element is found.</p>
<p>However, <code>lower_bound</code> still doesn't return enough information for all uses, so the standard library also offers</p>
<div class="language-text highlight"><pre><span></span><code>template&lt;class ForwardIterator, class T&gt;
pair&lt;ForwardIterator, ForwardIterator&gt;
equal_range(ForwardIterator first, ForwardIterator last, const T&amp; val);
</code></pre></div>
<p><code>equal_range</code> returns a <code>pair</code> of iterators specifying the first and one beyond last match.</p>
<div class="language-text highlight"><pre><span></span><code>auto r = equal_range(begin(c), end(c), 7);
for (auto p = r.first; p != r.second; ++p)
    cout &lt;&lt; *p &lt;&lt; &#39;\n&#39;;
</code></pre></div>
<p>Obviously, these three interfaces are implemented by the same basic code.
They are simply three ways of presenting the basic binary search algorithm to users,
ranging from the simplest ("make simple things simple!")
to returning complete, but not always needed, information ("don't hide useful information").
Naturally, crafting such a set of interfaces requires experience and domain knowledge.</p>
<h5 id="note_7">Note<a class="headerlink" href="#note_7" title="Permanent link">&para;</a></h5>
<p>Do not simply craft the interface to match the first implementation and the first use case you think of.
Once your first initial implementation is complete, review it; once you deploy it, mistakes will be hard to remedy.</p>
<h5 id="note_8">Note<a class="headerlink" href="#note_8" title="Permanent link">&para;</a></h5>
<p>A need for efficiency does not imply a need for <a href="#Rper-low">low-level code</a>.
High-level code isn't necessarily slow or bloated.</p>
<h5 id="note_9">Note<a class="headerlink" href="#note_9" title="Permanent link">&para;</a></h5>
<p>Things have costs.
Don't be paranoid about costs (modern computers really are very fast),
but have a rough idea of the order of magnitude of cost of what you use.
For example, have a rough idea of the cost of
a memory access,
a function call,
a string comparison,
a system call,
a disk access,
and a message through a network.</p>
<h5 id="note_10">Note<a class="headerlink" href="#note_10" title="Permanent link">&para;</a></h5>
<p>If you can only think of one implementation, you probably don't have something for which you can devise a stable interface.
Maybe, it is just an implementation detail - not every piece of code needs a stable interface - but pause and consider.
One question that can be useful is
"what interface would be needed if this operation should be implemented using multiple threads? be vectorized?"</p>
<h5 id="note_11">Note<a class="headerlink" href="#note_11" title="Permanent link">&para;</a></h5>
<p>This rule does not contradict the <a href="#Rper-Knuth">Don't optimize prematurely</a> rule.
It complements it, encouraging developers to enable later - appropriate and non-premature - optimization, if and where needed.</p>
<h5 id="enforcement">Enforcement<a class="headerlink" href="#enforcement" title="Permanent link">&para;</a></h5>
<p>Tricky.
Maybe looking for <code>void*</code> function arguments will find examples of interfaces that hinder later optimization.</p>
<h3 id="per10-rely-on-the-static-type-system"><a name="Rper-type"></a>Per.10: Rely on the static type system<a class="headerlink" href="#per10-rely-on-the-static-type-system" title="Permanent link">&para;</a></h3>
<h5 id="reason_7">Reason<a class="headerlink" href="#reason_7" title="Permanent link">&para;</a></h5>
<p>Type violations, weak types (e.g. <code>void*</code>s), and low-level code (e.g., manipulation of sequences as individual bytes) make the job of the optimizer much harder. Simple code often optimizes better than hand-crafted complex code.</p>
<p>???</p>
<h3 id="per11-move-computation-from-run-time-to-compile-time"><a name="Rper-Comp"></a>Per.11: Move computation from run time to compile time<a class="headerlink" href="#per11-move-computation-from-run-time-to-compile-time" title="Permanent link">&para;</a></h3>
<h5 id="reason_8">Reason<a class="headerlink" href="#reason_8" title="Permanent link">&para;</a></h5>
<p>To decrease code size and run time.
To avoid data races by using constants.
To catch errors at compile time (and thus eliminate the need for error-handling code).</p>
<h5 id="example_2">Example<a class="headerlink" href="#example_2" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code>double square(double d) { return d*d; }
static double s2 = square(2);    // old-style: dynamic initialization

constexpr double ntimes(double d, int n)   // assume 0 &lt;= n
{
        double m = 1;
        while (n--) m *= d;
        return m;
}
constexpr double s3 {ntimes(2, 3)};  // modern-style: compile-time initialization
</code></pre></div>
<p>Code like the initialization of <code>s2</code> isn't uncommon, especially for initialization that's a bit more complicated than <code>square()</code>.
However, compared to the initialization of <code>s3</code> there are two problems:</p>
<ul>
<li>we suffer the overhead of a function call at run time</li>
<li><code>s2</code> just might be accessed by another thread before the initialization happens.</li>
</ul>
<p>Note: you can't have a data race on a constant.</p>
<h5 id="example_3">Example<a class="headerlink" href="#example_3" title="Permanent link">&para;</a></h5>
<p>Consider a popular technique for providing a handle for storing small objects in the handle itself and larger ones on the heap.</p>
<div class="language-text highlight"><pre><span></span><code>constexpr int on_stack_max = 20;

template&lt;typename T&gt;
struct Scoped {     // store a T in Scoped
        // ...
    T obj;
};

template&lt;typename T&gt;
struct On_heap {    // store a T on the free store
        // ...
        T* objp;
};

template&lt;typename T&gt;
using Handle = typename std::conditional&lt;(sizeof(T) &lt;= on_stack_max),
                    Scoped&lt;T&gt;,      // first alternative
                    On_heap&lt;T&gt;      // second alternative
               &gt;::type;

void f()
{
    Handle&lt;double&gt; v1;                   // the double goes on the stack
    Handle&lt;std::array&lt;double, 200&gt;&gt; v2;  // the array goes on the free store
    // ...
}
</code></pre></div>
<p>Assume that <code>Scoped</code> and <code>On_heap</code> provide compatible user interfaces.
Here we compute the optimal type to use at compile time.
There are similar techniques for selecting the optimal function to call.</p>
<h5 id="note_12">Note<a class="headerlink" href="#note_12" title="Permanent link">&para;</a></h5>
<p>The ideal is <em>not</em> to try to execute everything at compile time.
Obviously, most computations depend on inputs, so they can't be moved to compile time,
but beyond that logical constraint is the fact that complex compile-time computation can seriously increase compile times
and complicate debugging.
It is even possible to slow down code by compile-time computation.
This is admittedly rare, but by factoring out a general computation into separate optimal sub-calculations, it is possible to render the instruction cache less effective.</p>
<h5 id="enforcement_1">Enforcement<a class="headerlink" href="#enforcement_1" title="Permanent link">&para;</a></h5>
<ul>
<li>Look for simple functions that might be constexpr (but are not).</li>
<li>Look for functions called with all constant-expression arguments.</li>
<li>Look for macros that could be constexpr.</li>
</ul>
<h3 id="per12-eliminate-redundant-aliases"><a name="Rper-alias"></a>Per.12: Eliminate redundant aliases<a class="headerlink" href="#per12-eliminate-redundant-aliases" title="Permanent link">&para;</a></h3>
<p>???</p>
<h3 id="per13-eliminate-redundant-indirections"><a name="Rper-indirect"></a>Per.13: Eliminate redundant indirections<a class="headerlink" href="#per13-eliminate-redundant-indirections" title="Permanent link">&para;</a></h3>
<p>???</p>
<h3 id="per14-minimize-the-number-of-allocations-and-deallocations"><a name="Rper-alloc"></a>Per.14: Minimize the number of allocations and deallocations<a class="headerlink" href="#per14-minimize-the-number-of-allocations-and-deallocations" title="Permanent link">&para;</a></h3>
<p>???</p>
<h3 id="per15-do-not-allocate-on-a-critical-branch"><a name="Rper-alloc0"></a>Per.15: Do not allocate on a critical branch<a class="headerlink" href="#per15-do-not-allocate-on-a-critical-branch" title="Permanent link">&para;</a></h3>
<p>???</p>
<h3 id="per16-use-compact-data-structures"><a name="Rper-compact"></a>Per.16: Use compact data structures<a class="headerlink" href="#per16-use-compact-data-structures" title="Permanent link">&para;</a></h3>
<h5 id="reason_9">Reason<a class="headerlink" href="#reason_9" title="Permanent link">&para;</a></h5>
<p>Performance is typically dominated by memory access times.</p>
<p>???</p>
<h3 id="per17-declare-the-most-used-member-of-a-time-critical-struct-first"><a name="Rper-struct"></a>Per.17: Declare the most used member of a time-critical struct first<a class="headerlink" href="#per17-declare-the-most-used-member-of-a-time-critical-struct-first" title="Permanent link">&para;</a></h3>
<p>???</p>
<h3 id="per18-space-is-time"><a name="Rper-space"></a>Per.18: Space is time<a class="headerlink" href="#per18-space-is-time" title="Permanent link">&para;</a></h3>
<h5 id="reason_10">Reason<a class="headerlink" href="#reason_10" title="Permanent link">&para;</a></h5>
<p>Performance is typically dominated by memory access times.</p>
<p>???</p>
<h3 id="per19-access-memory-predictably"><a name="Rper-access"></a>Per.19: Access memory predictably<a class="headerlink" href="#per19-access-memory-predictably" title="Permanent link">&para;</a></h3>
<h5 id="reason_11">Reason<a class="headerlink" href="#reason_11" title="Permanent link">&para;</a></h5>
<p>Performance is very sensitive to cache performance, and cache algorithms favor simple (usually linear) access to adjacent data.</p>
<h5 id="example_4">Example<a class="headerlink" href="#example_4" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code>int matrix[rows][cols];

// bad
for (int c = 0; c &lt; cols; ++c)
    for (int r = 0; r &lt; rows; ++r)
        sum += matrix[r][c];

// good
for (int r = 0; r &lt; rows; ++r)
    for (int c = 0; c &lt; cols; ++c)
        sum += matrix[r][c];
</code></pre></div>
<h3 id="per30-avoid-context-switches-on-the-critical-path"><a name="Rper-context"></a>Per.30: Avoid context switches on the critical path<a class="headerlink" href="#per30-avoid-context-switches-on-the-critical-path" title="Permanent link">&para;</a></h3>
<p>???</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="../js/open_in_new_tab.js"></script>
      
    
  </body>
</html>